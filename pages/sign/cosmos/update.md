# Proto Update

## Quickstart

### 1. Clone `sign` Repository

```sh
git clone git@github.com:cosmology-tech/sign.git
cd sign
```

### 2. Set Version

[scripts/download-proto.sh#L8-L10](https://github.com/cosmology-tech/sign/blob/main/scripts/download-proto.sh#L8-L10)

```sh filename="scripts/download-proto.sh"
...
## versions of targets
COSMOS_SDK_VERSION="v0.47.5"
IBC_GO_VERSION="v7.3.0"
WASMD_VERSION="v0.43.0"
...
```

> The version here is the github repository version. you can also set the version to be git commit hash

### 3. Run Update

```sh
yarn proto:update
```

## More Info

The proto update process can be split into 2 steps:

1. Download proto files
2. Generate codes with `telescope`

If you only need to download proto files, which will overwrite previous proto files, run

```sh
yarn proto:download
```

If you only need to generate codes, which will overwrite previous codes, run

```sh
yarn proto:codegen
```

### 1. Download Proto

There are 3 packages involve update of proto files.

- **@sign/cosmos-proto**
- **@sign/cosmos-stargate**
- **@sign/cosmos-cosmwasm-stargate**

The downloaded proto files will be stored in corresponding `proto` folder.

- [cosmos/proto/proto](https://github.com/cosmology-tech/sign/tree/main/cosmos/proto/proto)
- [cosmos/stargate/proto](https://github.com/cosmology-tech/sign/tree/main/cosmos/stargate/proto)
- [cosmos/cosmwasm-stargate/proto](https://github.com/cosmology-tech/sign/tree/main/cosmos/cosmwasm-stargate/proto)

All proto files information is recorded in corresponding `README.md` file.

- [cosmos/proto/proto/README.md](https://github.com/cosmology-tech/sign/tree/main/cosmos/proto/proto/README.md)
- [cosmos/stargate/proto/README.md](https://github.com/cosmology-tech/sign/tree/main/cosmos/stargate/proto)
- [cosmos/cosmwasm-stargate/proto/README.md](https://github.com/cosmology-tech/sign/tree/main/cosmos/cosmwasm-stargate/proto/README.md)

#### `README.md` Table Explain

| Head       | Description                                                                                 |
| :--------- | ------------------------------------------------------------------------------------------- |
| **File**   | Relative path of downloaded proto file. The link directs to the source url when downloading |
| **Repo**   | Github repository name                                                                      |
| **Commit** | Github version/commit name                                                                  |
| **Type**   | `target` or `dependency`. To check if it's target file or not                               |
| **Code**   | Fetch response code. If it's 200, means proto file is successfully downloaded               |

Target files for each package are configured in corresponding `scripts/download-proto.sh`.

- [cosmos/proto/scripts/download-proto.sh](https://github.com/cosmology-tech/sign/tree/main/cosmos/proto/scripts/download-proto.sh)
- [cosmos/stargate/scripts/download-proto.sh](https://github.com/cosmology-tech/sign/tree/main/cosmos/stargate/scripts/download-proto.sh)
- [cosmos/cosmwasm-stargate/scripts/download-proto.sh](https://github.com/cosmology-tech/sign/tree/main/cosmos/cosmwasm-stargate/scripts/download-proto.sh)

### 2. Generate Code

After all proto files being downloaded, it will automatically generate typescript codes with `telescope`.

Codes generated are stored in corresponding `src/codegen` folder.

- [cosmos/proto/src/codegen](https://github.com/cosmology-tech/sign/tree/main/cosmos/proto/src/codegen)
- [cosmos/stargate/src/codegen](https://github.com/cosmology-tech/sign/tree/main/cosmos/stargate/src/codegen)
- [cosmos/cosmwasm-stargate/src/codegen](https://github.com/cosmology-tech/sign/tree/main/cosmos/cosmwasm-stargate/src/codegen)

Generally above are all the changes done by proto update.
