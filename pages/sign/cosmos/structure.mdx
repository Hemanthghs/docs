# Code Structure

Here to briefly introduce the structure of `@cosmonauts/cosmos-*` packages, which is designed around the core functionality of `sign` and `broadcast` .

## Packages

| Package                            | Meant For                                   |
| :--------------------------------- | :------------------------------------------ |
| **@cosmonauts/cosmos-rpc**             | tendermint rpc client for querying and broadcasting                         |
| **@cosmonauts/cosmos-proto**             | proto/direct signing                        |
| **@cosmonauts/cosmos-amino**             | amino signing                               |
| **@cosmonauts/cosmos-cosmjs**            | signing with cosmjs signingClient interface |
| **@cosmonauts/cosmos-stargate**          | stargate signing                            |
| **@cosmonauts/cosmos-cosmwasm-stargate** | cosmwasm and stargate signing               |

> Dependency Order (`a -> b` means _b_ is dependent on _a_):
>
> `@cosmonauts/cosmos-rpc` -> `@cosmonauts/cosmos-proto` -> `@cosmonauts/cosmos-amino` -> `@cosmonauts/cosmos-cosmjs` -> `@cosmonauts/cosmos-stargate` -> `@cosmonauts/cosmos-cosmwasm-stargate`

> Registered messages types and `TelescopeGeneratedType` constants also be exported by `@cosmonauts/cosmos-stargate` and `@cosmonauts/cosmos-cosmwasm-stargate` to facilitate code developing.

## Signer Classes

There’re several types of signer class, and they’re

| Class                    | Package                          | Description                                                                                                                                                                                                                                                     |
| :----------------------- | :------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **BaseSigner**           | _@cosmonauts/core_                     | defines common methods independent of network i.e. _cosmos_ or _eth_                                                                                                                                                                                            |
| **Signer**               | _@cosmonauts/cosmos-proto_             | implements _proto/direct_ signing process                                                                                                                                                                                                                       |
| **AminoSigner**          | _@cosmonauts/cosmos-amino_             | extends Signer above and implements _amino_ signing process                                                                                                                                                                                                     |
| **CosmjsSigner**         | _@cosmonauts/cosmos-cosmjs_            | is meant for swift migration from _cosmjs_. It provides methods that are basically the same with _signingStargateClient_ and _stargateClient_ in _@cosmjs/stargate_. Note some returned _number_ are changed to _bigint_ in _CosmjsSigner_ compared to _cosmjs_ |
| **StargateSigner**       | _@cosmonauts/cosmos-stargate_          | is **Signer** that with _stargate_ message types being registered by default                                                                                                                                                                                    |
| **StargateAminoSigner**  | _@cosmonauts/cosmos-stargate_          | is **AminoSigner** that with _stargate_ message types being registered by default                                                                                                                                                                               |
| **StargateCosmjsSigner** | _@cosmonauts/cosmos-stargate_          | is **CosmjsSigner** that with _stargate_ message types being registered by default                                                                                                                                                                              |
| **CosmWasmSigner**       | _@cosmonauts/cosmos-cosmwasm-stargate_ | is **Signer** that with _stargate_ and _cosmwasm_ message types being registered by default                                                                                                                                                                     |
| **CosmWasmAminoSigner**  | _@cosmonauts/cosmos-cosmwasm-stargate_ | is **AminoSigner** that with _stargate_ and _cosmwasm_ message types being registered by default                                                                                                                                                                |
| **CosmWasmCosmjsSigner** | _@cosmonauts/cosmos-cosmwasm-stargate_ | is **CosmjsSigner** that with _stargate_ and _cosmwasm_ message types being registered by default                                                                                                                                                               |

> See more information of _stargate_ and _cosmwasm_ messages types: [Registered Messages](/cosmos/messages)

## Structure Tree

```sh
├── `@cosmonauts/core`
│   ├── class `BaseSigner`
│   │   ├── method `signBytes` (sign `Uint8Array`)
│   │   ├── method `verifyBytes` (verify `Uint8Array`)
│   │
├── `@cosmonauts/cosmos-proto`
│   ├── class `Signer` extends `BaseSigner`
│   │   ├── method (query) `getChainId`
│   │   ├── method (query) `getSequence`
│   │   ├── method `signDoc` (sign `SignDoc` with DIRECT signing)
│   │   ├── method `signMessages` (sign messages of type `EncodeObject[]` with DIRECT signing)
│   │   ├── method `broadcast` (broadcast `TxRaw`)
│   │   ├── method `broadcastBytes` (broadcast `Uint8Array`)
│   │   ├── method `estimateGas`
│   │   └── method `estimateFee`
│   │
├── `@cosmonauts/cosmos-amino`
│   ├── class `AminoSigner` extends `Signer`
│   │   ├── method `signDocWithAmino` (sign `StdDoc` with AMINO signing)
│   │   └── method `signMessagesWithAmino` (sign messages of type `EncodeObject[]` with AMINO signing)
│   │
├── `@cosmonauts/cosmos-cosmjs`
│   ├── class `CosmjsSigner` (with `AminoSigner` used inside)
│   │   │
│   │   ├── \* Shared methods with `SigningStargateClient` and `SigningCosmWasmClient` *\
│   │   ├── method (static) `connectWithSigner`
│   │   ├── method `simulate` (return `bigint` rather than `number`)
│   │   ├── method `sign`
│   │   ├── method `signAndBroadcast`
│   │   ├── method `signAndBroadcastSync`
│   │   │
│   │   ├── \* Shared methods with `StargateClient` and `CosmWasmClient` *\
│   │   ├── method (query) `getAccount`
│   │   ├── method (query) `getBlock`
│   │   ├── method (query) `getChainId`
│   │   ├── method (query) `getSequence`
│   │   ├── method (query) `getTx`
│   │   ├── method `broadcastTx`
│   │   └── method `broadcastTxSync`
│   │
├── `@cosmonauts/cosmos-stargate`
│   ├── class `StargateSigner` extends `Signer`
│   ├── class `StargateAminoSigner` extends `AminoSigner`
│   ├── class `StargateCosmjsSigner` extends `CosmjsSigner`
│   │
├── `@cosmonauts/cosmos-cosmwasm-stargate`
│   ├── class `CosmWasmSigner` extends `StargateSigner`
│   ├── class `CosmWasmAminoSigner` extends `StargateAminoSigner`
│   └── class `CosmWasmCosmjsSigner` extends `StargateCosmjsSigner`
```

## Generated Helper Methods

There are helper methods generated by `Telescope` and extended by `RpcClient`, `StargateCosmjsSigner` and `CosmWasmCosmjsSigner`.

### Query

Helper methods for query infomation like balances, delegations, proposals are available in `RpcClient`.

```ts
import { RpcClient } from "@cosmonauts/rpc";

const rpcClient = new RpcClient(“https://your-rpc-url-here”);
await rpcClient.account({ address });
await rpcClient.balance({ address });
await rpcClient.proposal({ proposalId });
await rpcClient.delegation({ delegatorAddr, validatorAddr });
...
```

All generated query helper methods can be found in [cosmos/rpc/src/codegen/service-ops.ts](https://github.com/cosmology-tech/sign/blob/main/cosmos/rpc/src/codegen/service-ops.ts)

To visit these methods from signers, you can get the `RpcClient` instance first.

```ts
import { Signer } from "@cosmonauts/proto";
import { AminoSigner } from "@cosmonauts/amino";
import { CosmjsSigner } from "@cosmonauts/cosmjs";

const rpcClient = new Signer().on(“https://your-rpc-url-here”).request;
const rpcClient = new AminoSigner().on(“https://your-rpc-url-here”).request;
const rpcClient = CosmjsSigner.connectWithSigner(“https://your-rpc-url-here”, offlineSigner).request;
...
```

To make `CosmjsSigner` compatible with `SigningStargateClient` and `SigningCosmWasmClient` interface in `@cosmjs`, some query helper methods (listed below) are directly available from `CosmjsSigner` without bypassing property `request`.

```ts
class CosmjsSigner {
  getBalance = this.request.balance;
  getAllBalances = this.request.allBalances;
  getBalanceStaked = this.request.delegatorDelegations;
  getDelegation = this.request.delegation;
  getCodes = this.request.codes;
  getCodeDetails = this.request.code;
  getContracts = this.request.contractsByCode;
  getContractsByCreator = this.request.contractsByCreator;
  getContract = this.request.contractInfo;
  getContractCodeHistory = this.request.contractHistory;
  queryContractRaw = this.request.rawContractState;
  queryContractSmart = this.request.smartContractState;
}
```

> **Advanced** 
> 
> To add more query helper methods in `RpcClient`, download more protos (edit [cosmos/rpc/scripts/download-proto.sh](https://github.com/cosmology-tech/sign/blob/main/cosmos/rpc/scripts/download-proto.sh) and modify [Telescope config](https://github.com/cosmology-tech/sign/blob/main/cosmos/rpc/.telescope.ext.json) (path: `options.rpcClients.instantOpts[0].include.patterns`). And then run `yarn proto:update` in `cosmos/rpc` folder.

### Sign & Broadcast

Helper methods for signing and broadcasting some particular types of messages (called message helper methods below) are available in `StargateCosmjsSigner` and `CosmWasmCosmjsSigner`.

### Stargate

```ts
import { StargateCosmjsSigner } from "@cosmonauts/stargate";

const signer = StargateCosmjsSigner.connectWithSigner(“https://your-rpc-url-here”, offlineSigner);
await signer.send(signerAddress, message, fee, memo);
await signer.vote(signerAddress, message, fee, memo);
await signer.delegate(signerAddress, message, fee, memo);
await signer.transfer(signerAddress, message, fee, memo);
...
```

The type of argument `message` is different between these methods. And all generated message helper methods can be found in [cosmos/stargate/src/codegen/service-ops.ts](https://github.com/cosmology-tech/sign/blob/main/cosmos/stargate/src/codegen/service-ops.ts)

To make `StargateCosmjsSigner` compatible with `SigningStargateClient` interface in `@cosmjs/stargate`, some helper methods (listed below) are made a renamed copy in `StargateCosmjsSigner`.

```ts
class StargateCosmjsSigner {
  sendTokens = this.send;
  delegateTokens = this.delegate;
  undelegateTokens = this.undelegate;
  withdrawRewards = this.withdrawDelegatorReward;
  sendIbcTokens = this.transfer;
}
```

> **Advanced** 
> 
> To add more stargate message helper methods in `StargateCosmjsSigner`, download more protos (edit [cosmos/stargate/scripts/download-proto.sh](https://github.com/cosmology-tech/sign/blob/main/cosmos/stargate/scripts/download-proto.sh) and modify [Telescope config](https://github.com/cosmology-tech/sign/blob/main/cosmos/stargate/.telescope.ext.json) (path: `options.rpcClients.instantOpts[0].include.patterns`). And then run `yarn proto:update` in `cosmos/stargate` folder.

### CosmWasm

```ts
import { CosmWasmCosmjsSigner } from "@cosmonauts/cosmwasm-stargate";

const signer = CosmWasmCosmjsSigner.connectWithSigner(“https://your-rpc-url-here”, offlineSigner);
await signer.storeCode(signerAddress, message, fee, memo);
await signer.migrateContract(signerAddress, message, fee, memo);
...
```

The type of argument `message` is different between these methods. And all generated message helper methods can be found in [cosmos/cosmwasm-stargate/src/codegen/service-ops.ts](https://github.com/cosmology-tech/sign/blob/main/cosmos/cosmwasm-stargate/src/codegen/service-ops.ts).

To make `CosmWasmCosmjsSigner` compatible with `SigningCosmWasmClient` interface in `@cosmjs/cosmwasm-stargate`, some helper methods (listed below) are made a renamed copy in `CosmWasmCosmjsSigner`.

```ts
class CosmWasmCosmjsSigner {
  upload = this.storeCode;
  instantiate = this.instantiateContract;
  instantiate2 = this.instantiateContract2;
  migrate = this.migrateContract;
  executeMultiple = this.executeContract;
}
```

> **Advanced** 
> 
> To add more cosmwasm message helper methods in `CosmWasmCosmjsSigner`, download more protos (edit [cosmos/cosmwasm-stargate/scripts/download-proto.sh](https://github.com/cosmology-tech/sign/blob/main/cosmos/cosmwasm-stargate/scripts/download-proto.sh) and modify [Telescope config](https://github.com/cosmology-tech/sign/blob/main/cosmos/cosmwasm-stargate/.telescope.ext.json) (path: `options.rpcClients.instantOpts[0].include.patterns`). And then run `yarn proto:update` in `cosmos/cosmwasm-stargate` folder.

At last, just a reminder that `CosmWasmCosmjsSigner` extends `StargateCosmjsSigner`, so all helper methods in `StargateCosmjsSigner` are also available in `CosmWasmCosmjsSigner`.
